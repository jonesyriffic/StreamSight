<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GSP Insights Hub - {% block title %}Product Manager's Knowledge Hub{% endblock %}</title>
    
    <!-- Material Design Web Components -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Material Web Components -->
    <script type="module">
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/button/filled-button.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/button/outlined-button.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/button/text-button.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/fab/fab.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/icon/icon.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/checkbox/checkbox.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/switch/switch.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/textfield/filled-text-field.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/textfield/outlined-text-field.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/ripple/ripple.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/divider/divider.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/dialog/dialog.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/card/elevated-card.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/card/outlined-card.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/card/filled-card.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/progress/circular-progress.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/progress/linear-progress.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/tabs/tabs.js';
      import 'https://cdn.jsdelivr.net/npm/@material/web@1.0.0/tabs/primary-tab.js';
    </script>
    
    <!-- Bootstrap CSS (Replit Theme) - keeping for compatibility during transition -->
    <link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF.js for PDF rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    
    <!-- Intro.js for interactive tours -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intro.js@7.2.0/minified/introjs.min.css">
    <script src="https://cdn.jsdelivr.net/npm/intro.js@7.2.0/minified/intro.min.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}?v={{ range(1000, 9999) | random }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tour.css') }}?v={{ range(1000, 9999) | random }}">
    <!-- Material Design v3 Specific Styles - Added on March 31, 2025 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/md3-styles.css') }}?v={{ range(1000, 9999) | random }}">
    
    <!-- Material Design v3 Styles -->
    <style>
        /* Material Design 3 Theme Variables */
        :root {
            /* Primary theme colors */
            --md-sys-color-primary: #a8c7fa;
            --md-sys-color-on-primary: #062e6f;
            --md-sys-color-primary-container: #234589;
            --md-sys-color-on-primary-container: #d6e3ff;
            
            /* Secondary colors */
            --md-sys-color-secondary: #bcc7dc;
            --md-sys-color-on-secondary: #283041;
            --md-sys-color-secondary-container: #3e4759;
            --md-sys-color-on-secondary-container: #d8e3f8;
            
            /* Tertiary colors */
            --md-sys-color-tertiary: #d6bee4;
            --md-sys-color-on-tertiary: #402a4a;
            --md-sys-color-tertiary-container: #584062;
            --md-sys-color-on-tertiary-container: #f2daff;
            
            /* Error colors */
            --md-sys-color-error: #ffb4ab;
            --md-sys-color-on-error: #690005;
            --md-sys-color-error-container: #93000a;
            --md-sys-color-on-error-container: #ffb4ab;

            /* Background colors */
            --md-sys-color-background: #1a1c1e;
            --md-sys-color-on-background: #e2e2e6;
            --md-sys-color-surface: #121316;
            --md-sys-color-on-surface: #c4c6d0;
            --md-sys-color-surface-variant: #43474e;
            --md-sys-color-on-surface-variant: #c3c7cf;

            /* Other colors */
            --md-sys-color-outline: #8d9199;
            --md-sys-color-outline-variant: #43474e;
            --md-sys-color-shadow: #000000;
            --md-sys-color-surface-tint: #a8c7fa;
            --md-sys-color-inverse-surface: #e2e2e6;
            --md-sys-color-inverse-on-surface: #2f3033;
            
            /* Category colors in MD3 palette */
            --color-insights: #52d7ff;
            --color-tech: #4ce0b3;
            --color-product: #5b8eff;
            --color-service: #ffce41;
            
            /* Elevation values */
            --md-elevation-1: 0px 1px 2px rgba(0,0,0,0.3), 0px 1px 3px 1px rgba(0,0,0,0.15);
            --md-elevation-2: 0px 2px 4px rgba(0,0,0,0.3), 0px 1px 8px rgba(0,0,0,0.12);
            --md-elevation-3: 0px 4px 8px rgba(0,0,0,0.3), 0px 2px 12px rgba(0,0,0,0.15);
            --md-elevation-4: 0px 6px 12px rgba(0,0,0,0.3), 0px 4px 16px rgba(0,0,0,0.15);
            --md-elevation-5: 0px 8px 16px rgba(0,0,0,0.3), 0px 6px 24px rgba(0,0,0,0.15);
            
            /* Animation durations */
            --md-motion-duration-short: 100ms;
            --md-motion-duration-medium: 200ms;
            --md-motion-duration-long: 300ms;
            
            /* Typography */
            --md-sys-typescale-font-family: 'Roboto', 'Google Sans', sans-serif;
            --md-sys-typescale-title-large-font-family: 'Google Sans', 'Roboto', sans-serif;
            --md-sys-typescale-title-large-font-size: 1.5rem;
            --md-sys-typescale-title-large-font-weight: 400;
            --md-sys-typescale-title-medium-font-size: 1.25rem;
            --md-sys-typescale-title-medium-font-weight: 500;
            --md-sys-typescale-body-medium-font-size: 0.875rem;
            --md-sys-typescale-body-medium-font-weight: 400;
        }
        
        /* Document category colors */
        .bg-insights, .text-insights { color: var(--color-insights) !important; }
        .bg-tech, .text-tech { color: var(--color-tech) !important; }
        .bg-product, .text-product { color: var(--color-product) !important; }
        .bg-service, .text-service { color: var(--color-service) !important; }
        
        /* Material Typography */
        body {
            font-family: var(--md-sys-typescale-font-family);
            color: var(--md-sys-color-on-background);
            background-color: var(--md-sys-color-background);
            min-height: 100vh;
            margin: 0;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* App container styles */
        .md-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
        }
        
        /* Header styling */
        header {
            background-color: var(--md-sys-color-surface);
            box-shadow: var(--md-elevation-2);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .navbar-brand {
            font-family: var(--md-sys-typescale-title-large-font-family);
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        /* Material Card Styles */
        .md-card {
            background-color: var(--md-sys-color-surface-variant);
            border-radius: 16px;
            overflow: hidden;
            transition: all var(--md-motion-duration-medium) cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--md-elevation-1);
            margin-bottom: 16px;
            position: relative;
        }
        
        .md-card:hover {
            box-shadow: var(--md-elevation-3);
            transform: translateY(-4px);
        }
        
        .md-card-header {
            padding: 16px;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
        }
        
        .md-card-content {
            padding: 16px;
        }
        
        .md-card-footer {
            padding: 16px;
            border-top: 1px solid var(--md-sys-color-outline-variant);
        }
        
        /* Category-based card styling */
        .md-card.card-insights {
            border-left: 4px solid var(--color-insights);
        }
        
        .md-card.card-tech {
            border-left: 4px solid var(--color-tech);
        }
        
        .md-card.card-product {
            border-left: 4px solid var(--color-product);
        }
        
        .md-card.card-service {
            border-left: 4px solid var(--color-service);
        }
        
        /* Material Button styles */
        .md-btn {
            position: relative;
            overflow: hidden;
            border-radius: 20px;
            padding: 10px 16px;
            transition: background-color var(--md-motion-duration-short) cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .md-btn-filled {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
        }
        
        .md-btn-outlined {
            background-color: transparent;
            color: var(--md-sys-color-primary);
            border: 1px solid var(--md-sys-color-outline);
        }
        
        .md-btn-text {
            background-color: transparent;
            color: var(--md-sys-color-primary);
        }
        
        /* Badge styles */
        .md-badge {
            border-radius: 16px;
            padding: 4px 12px;
            font-size: 0.75rem;
            font-weight: 500;
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
        }
        
        /* Form styles */
        .md-input {
            border-radius: 4px;
            padding: 16px;
            background-color: var(--md-sys-color-surface-variant);
            border: 1px solid var(--md-sys-color-outline);
            color: var(--md-sys-color-on-surface);
            transition: border-color 0.2s;
        }
        
        .md-input:focus {
            border-color: var(--md-sys-color-primary);
            outline: none;
        }
        
        /* Table styles */
        .md-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 16px;
        }
        
        .md-table th {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            padding: 12px 16px;
            text-align: left;
            font-weight: 500;
        }
        
        .md-table td {
            padding: 12px 16px;
            border-top: 1px solid var(--md-sys-color-outline-variant);
        }
        
        /* Footer styling */
        footer {
            background-color: var(--md-sys-color-surface);
            box-shadow: var(--md-elevation-2);
            padding: 24px 0;
            margin-top: 48px;
        }
        
        /* Utility classes */
        .md-shadow-1 {
            box-shadow: var(--md-elevation-1);
        }
        
        .md-shadow-3 {
            box-shadow: var(--md-elevation-3);
        }
        
        .md-text-truncate-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Modal styling */
        .md-dialog {
            border-radius: 28px;
            background-color: var(--md-sys-color-surface);
            box-shadow: var(--md-elevation-3);
            max-width: 560px;
            padding: 24px;
        }
        
        .md-dialog-title {
            font-family: var(--md-sys-typescale-title-large-font-family);
            font-size: var(--md-sys-typescale-title-large-font-size);
            font-weight: var(--md-sys-typescale-title-large-font-weight);
            margin-bottom: 16px;
        }
        
        .md-dialog-content {
            margin-bottom: 24px;
        }
        
        .md-dialog-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }
        
        /* Floating Action Button */
        .md-fab {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--md-elevation-3);
            position: fixed;
            bottom: 16px;
            right: 16px;
            transition: all var(--md-motion-duration-short) cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .md-fab:hover {
            box-shadow: var(--md-elevation-4);
            transform: translateY(-2px);
        }
    </style>
    
    {% block extra_head %}{% endblock %}
</head>
<body>
    <header class="md-shadow-1">
        <nav class="navbar navbar-expand-lg navbar-dark py-3">
            <div class="container">
                <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
                    <img src="{{ url_for('static', filename='images/gspinsightshub.png') }}" alt="GSP Insights Hub Logo" style="height: 50px;" class="me-2">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link px-3 rounded-pill mx-1 {{ 'active' if request.path == url_for('index') }}" href="{{ url_for('index') }}" style="color: var(--md-sys-color-on-surface); opacity: 0.9;">
                                <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">dashboard</span>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link px-3 rounded-pill mx-1 {{ 'active' if request.path == url_for('library') }}" href="{{ url_for('library') }}" style="color: var(--md-sys-color-on-surface); opacity: 0.9;">
                                <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">library_books</span>
                                Library
                            </a>
                        </li>
                        {% if current_user.is_authenticated %}
                        {% if current_user.can_upload or current_user.is_admin %}
                        <li class="nav-item">
                            <a class="nav-link px-3 rounded-pill mx-1 {{ 'active' if request.path == url_for('upload_page') }}" href="{{ url_for('upload_page') }}" style="color: var(--md-sys-color-on-surface); opacity: 0.9;">
                                <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">upload_file</span>
                                Upload
                            </a>
                        </li>
                        {% endif %}
                        {% if current_user.is_admin %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle px-3 rounded-pill mx-1 {{ 'active' if '/admin/' in request.path }}" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color: var(--md-sys-color-on-surface); opacity: 0.9;">
                                <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">admin_panel_settings</span>
                                Admin
                            </a>
                            <ul class="dropdown-menu border-0 md-shadow-1" style="background-color: var(--md-sys-color-surface-variant); border-radius: 8px;" aria-labelledby="adminDropdown">
                                <li>
                                    <a class="dropdown-item {{ 'active' if request.path == url_for('admin_dashboard') }}" href="{{ url_for('admin_dashboard') }}" style="color: var(--md-sys-color-on-surface-variant); padding: 8px 16px;">
                                        <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">dashboard</span> 
                                        Dashboard
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item {{ 'active' if request.path == url_for('admin_users') }}" href="{{ url_for('admin_users') }}" style="color: var(--md-sys-color-on-surface-variant); padding: 8px 16px;">
                                        <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">group</span> 
                                        User Management
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item {{ 'active' if request.path == url_for('admin_search_analytics') }}" href="{{ url_for('admin_search_analytics') }}" style="color: var(--md-sys-color-on-surface-variant); padding: 8px 16px;">
                                        <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">analytics</span> 
                                        Search Analytics
                                    </a>
                                </li>
                            </ul>
                        </li>
                        {% endif %}
                        {% endif %}
                    </ul>
                    <div class="ms-auto me-2"></div>
                    <ul class="navbar-nav">
                        {% if current_user.is_authenticated %}
                        <li class="nav-item me-2">
                            <a class="nav-link px-3 rounded-pill {{ 'active' if request.path == url_for('tour_page') }}" href="{{ url_for('tour_page') }}" id="nav-tour-link" style="color: var(--md-sys-color-on-surface); opacity: 0.9;">
                                <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">tour</span>
                                Tour
                            </a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle px-3 rounded-pill" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color: var(--md-sys-color-on-surface); opacity: 0.9;">
                                <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">account_circle</span>
                                {{ current_user.name or current_user.email }}
                                {% if current_user.is_admin %}
                                <span class="md-badge ms-1" style="background-color: var(--md-sys-color-error-container); color: var(--md-sys-color-on-error-container);">Admin</span>
                                {% endif %}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end border-0 md-shadow-1" style="background-color: var(--md-sys-color-surface-variant); border-radius: 8px;" aria-labelledby="userDropdown">
                                <li>
                                    <a class="dropdown-item {{ 'active' if request.path == url_for('profile') }}" href="{{ url_for('profile') }}" style="color: var(--md-sys-color-on-surface-variant); padding: 8px 16px;">
                                        <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">person</span>
                                        Profile
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item {{ 'active' if request.path == url_for('user_badges') }}" href="{{ url_for('user_badges') }}" style="color: var(--md-sys-color-on-surface-variant); padding: 8px 16px;">
                                        <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">military_tech</span>
                                        My Badges
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider" style="opacity: 0.25;"></li>
                                <li>
                                    <a class="dropdown-item" href="{{ url_for('logout') }}" style="color: var(--md-sys-color-on-surface-variant); padding: 8px 16px;">
                                        <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">logout</span>
                                        Logout
                                    </a>
                                </li>
                            </ul>
                        </li>
                        {% else %}
                        <li class="nav-item me-2">
                            <a class="nav-link px-3 rounded-pill {{ 'active' if request.path == url_for('tour_page') }}" href="{{ url_for('tour_page') }}" id="nav-tour-link" style="color: var(--md-sys-color-on-surface); opacity: 0.9;">
                                <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">tour</span>
                                Tour
                            </a>
                        </li>
                        <li class="nav-item me-2">
                            <a class="nav-link px-3 rounded-pill {{ 'active' if request.path == url_for('login') }}" href="{{ url_for('login') }}" style="color: var(--md-sys-color-on-surface); opacity: 0.9;">
                                <span class="material-symbols-outlined align-middle me-1" style="font-size: 1.2rem;">login</span>
                                Login
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{ url_for('register') }}">
                                <md-outlined-button>
                                    <span class="material-symbols-outlined" slot="icon">person_add</span>
                                    Register
                                </md-outlined-button>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mt-4">
        <!-- Flash messages with Material Design styling -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1050;">
                {% for category, message in messages %}
                    <div class="toast show md-shadow-1" role="alert" aria-live="assertive" aria-atomic="true" style="background-color: var(--md-sys-color-surface-variant); border-radius: 16px; border: none; overflow: hidden;">
                        <div class="toast-header" style="
                            {% if category == 'success' %}background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container);
                            {% elif category == 'warning' %}background-color: #8B5000; color: #FFDED6;
                            {% elif category == 'danger' %}background-color: var(--md-sys-color-error-container); color: var(--md-sys-color-on-error-container);
                            {% else %}background-color: var(--md-sys-color-tertiary-container); color: var(--md-sys-color-on-tertiary-container);{% endif %}
                            border: none; padding: 12px 16px;">
                            <span class="material-symbols-outlined me-2">
                                {% if category == 'success' %}check_circle
                                {% elif category == 'warning' %}warning
                                {% elif category == 'danger' %}error
                                {% else %}info{% endif %}
                            </span>
                            <strong class="me-auto" style="font-family: var(--md-sys-typescale-title-medium-font-family);">
                                {% if category == 'success' %}Success
                                {% elif category == 'warning' %}Warning
                                {% elif category == 'danger' %}Error
                                {% else %}Information{% endif %}
                            </strong>
                            <small>Just now</small>
                            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                        <div class="toast-body" style="padding: 16px; color: var(--md-sys-color-on-surface-variant);">
                            {{ message }}
                        </div>
                    </div>
                {% endfor %}
                </div>
                
                <!-- Backup alerts in case JavaScript is disabled -->
                <div class="d-none d-js-block">
                {% for category, message in messages %}
                    <div class="alert alert-dismissible fade show md-shadow-1" role="alert" style="
                        {% if category == 'success' %}background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container);
                        {% elif category == 'warning' %}background-color: #8B5000; color: #FFDED6;
                        {% elif category == 'danger' %}background-color: var(--md-sys-color-error-container); color: var(--md-sys-color-on-error-container);
                        {% else %}background-color: var(--md-sys-color-tertiary-container); color: var(--md-sys-color-on-tertiary-container);{% endif %}
                        border-radius: 16px; border: none; margin-bottom: 16px;">
                        <div class="d-flex align-items-center">
                            <span class="material-symbols-outlined me-2">
                                {% if category == 'success' %}check_circle
                                {% elif category == 'warning' %}warning
                                {% elif category == 'danger' %}error
                                {% else %}info{% endif %}
                            </span>
                            <div>{{ message }}</div>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <footer style="background-color: var(--md-sys-color-surface); padding: 32px 0; margin-top: 64px;">
        <div class="container">
            <div class="row">
                <div class="col-md-6 mb-4 mb-md-0">
                    <h5 class="mb-3" style="font-family: var(--md-sys-typescale-title-large-font-family); color: var(--md-sys-color-on-surface);">
                        <img src="{{ url_for('static', filename='images/gspinsightshub.png') }}" alt="GSP Insights Hub Logo" style="height: 40px;" class="me-2">
                    </h5>
                    <p class="mb-0" style="color: var(--md-sys-color-on-surface-variant);">AI-powered document insights platform for product managers to discover, analyze, and collaborate on industry knowledge.</p>
                </div>
                <div class="col-md-3 mb-4 mb-md-0">
                    <h6 class="mb-3" style="color: var(--color-insights); font-family: var(--md-sys-typescale-title-medium-font-family);">Quick Links</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a href="{{ url_for('index') }}" style="color: var(--md-sys-color-on-surface-variant); text-decoration: none; display: flex; align-items: center;">
                                <span class="material-symbols-outlined me-2" style="font-size: 1.1rem;">dashboard</span>
                                Dashboard
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="{{ url_for('library') }}" style="color: var(--md-sys-color-on-surface-variant); text-decoration: none; display: flex; align-items: center;">
                                <span class="material-symbols-outlined me-2" style="font-size: 1.1rem;">library_books</span>
                                Library
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('tour_page') }}" style="color: var(--md-sys-color-on-surface-variant); text-decoration: none; display: flex; align-items: center;">
                                <span class="material-symbols-outlined me-2" style="font-size: 1.1rem;">tour</span>
                                Interactive Tour
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6 class="mb-3" style="color: var(--color-insights); font-family: var(--md-sys-typescale-title-medium-font-family);">Categories</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a href="{{ url_for('library', category='Industry Insights') }}" style="color: var(--md-sys-color-on-surface-variant); text-decoration: none; display: flex; align-items: center;">
                                <span class="material-symbols-outlined me-2" style="font-size: 1.1rem; color: var(--color-insights);">insights</span>
                                Industry Insights
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="{{ url_for('library', category='Technology News') }}" style="color: var(--md-sys-color-on-surface-variant); text-decoration: none; display: flex; align-items: center;">
                                <span class="material-symbols-outlined me-2" style="font-size: 1.1rem; color: var(--color-tech);">memory</span>
                                Technology News
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="{{ url_for('library', category='Product Management') }}" style="color: var(--md-sys-color-on-surface-variant); text-decoration: none; display: flex; align-items: center;">
                                <span class="material-symbols-outlined me-2" style="font-size: 1.1rem; color: var(--color-product);">task</span>
                                Product Management
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('library', category='Customer Service') }}" style="color: var(--md-sys-color-on-surface-variant); text-decoration: none; display: flex; align-items: center;">
                                <span class="material-symbols-outlined me-2" style="font-size: 1.1rem; color: var(--color-service);">support_agent</span>
                                Customer Service
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <md-divider style="margin: 24px 0;"></md-divider>
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
                <p class="mb-3 mb-md-0" style="color: var(--md-sys-color-on-surface-variant);">GSP Insights Hub &copy; 2025</p>
                <p class="mb-0" style="color: var(--md-sys-color-on-surface-variant); font-size: 0.875rem;">
                    Made with
                    <span class="material-symbols-outlined align-middle mx-1" style="font-size: 1rem; color: var(--md-sys-color-error);">favorite</span>
                    by the NextGen Products Team
                </p>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Toastr Notifications -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    
    <!-- Main JavaScript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <!-- Initialize Toastr -->
    <script>
        // Configure toastr notification defaults
        toastr.options = {
            "closeButton": true,
            "progressBar": true,
            "positionClass": "toast-top-right",
            "preventDuplicates": false,
            "timeOut": "5000"
        }
    </script>
    <script src="{{ url_for('static', filename='js/tour.js') }}"></script>
    
    {% block extra_scripts %}{% endblock %}
    
    <!-- Initialize toasts -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize all toasts
            var toastElList = [].slice.call(document.querySelectorAll('.toast'));
            toastElList.map(function(toastEl) {
                return new bootstrap.Toast(toastEl, {
                    autohide: true,
                    delay: 5000
                });
            });
            
            // Add "d-js-block" class to body when JavaScript is enabled
            document.body.classList.add('d-js-block');
        });
    </script>
    
    <!-- Material Design v3 Initialization -->
    <script>
        // Material Design initialization - balanced approach to fix functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize bootstrap components
            if (typeof bootstrap !== 'undefined') {
                // Initialize dropdowns
                var dropdownElementList = [].slice.call(document.querySelectorAll('.dropdown-toggle'));
                dropdownElementList.forEach(function (dropdownToggleEl) {
                    new bootstrap.Dropdown(dropdownToggleEl);
                });
                
                // Initialize toasts
                var toastElList = [].slice.call(document.querySelectorAll('.toast'));
                toastElList.forEach(function(toastEl) {
                    new bootstrap.Toast(toastEl, {
                        autohide: true,
                        delay: 5000
                    });
                });
            }
            
            // Apply Material Design styling without breaking functionality
            // Convert Bootstrap buttons to Material buttons where classes are applied
            document.querySelectorAll('.btn-primary').forEach(button => {
                if (!button.classList.contains('no-md-convert')) {
                    button.classList.add('md-btn', 'md-btn-filled');
                }
            });
            
            document.querySelectorAll('.btn-outline-primary, .btn-outline-info').forEach(button => {
                if (!button.classList.contains('no-md-convert') && !button.getAttribute('href')?.includes('search?query=')) {
                    button.classList.add('md-btn', 'md-btn-outlined');
                }
            });
            
            document.querySelectorAll('.btn-secondary, .btn-info').forEach(button => {
                if (!button.classList.contains('no-md-convert')) {
                    button.classList.add('md-btn', 'md-btn-text');
                }
            });
            
            // Convert Bootstrap cards to Material cards
            document.querySelectorAll('.card').forEach(card => {
                if (!card.classList.contains('no-md-convert')) {
                    card.classList.add('md-card');
                    
                    // Add category styling if needed
                    if (card.classList.contains('card-insights')) card.classList.add('card-insights');
                    if (card.classList.contains('card-tech')) card.classList.add('card-tech');
                    if (card.classList.contains('card-product')) card.classList.add('card-product');
                    if (card.classList.contains('card-service')) card.classList.add('card-service');
                }
            });
            
            // Convert Bootstrap badges to Material badges
            document.querySelectorAll('.badge').forEach(badge => {
                if (!badge.classList.contains('no-md-convert')) {
                    badge.classList.add('md-badge');
                }
            });
            
            // Fix search example buttons to ensure they work correctly
            document.querySelectorAll('#exampleSearches a, #searchResultsExamples a').forEach(button => {
                // Remove any event listeners by cloning the node
                const parent = button.parentNode;
                const clone = button.cloneNode(true);
                parent.replaceChild(clone, button);
            });
        });
    </script>
    
    <!-- Search in Progress Overlay -->
    <!-- Enhanced Search In Progress Overlay with Material Design V3 and AI thinking process -->
    <div id="searchInProgressOverlay">
        <div class="loader-container md-elevation-5">
            <div class="sparkle-container">
                <div class="sparkle sparkle-1"></div>
                <div class="sparkle sparkle-2"></div>
                <div class="sparkle sparkle-3"></div>
                <div class="sparkle sparkle-4"></div>
                <div class="sparkle sparkle-5"></div>
                <div class="sparkle sparkle-6"></div>
            </div>
            <div class="search-status">Searching...</div>
            <div class="search-query"></div>
            
            <!-- Real-time AI thinking indicators -->
            <div class="ai-thinking-container">
                <div class="thinking-timeline">
                    <div class="timeline-progress"></div>
                </div>
                
                <div class="thinking-stages">
                    <div class="thinking-stage" id="stage-searching">
                        <div class="stage-indicator">
                            <div class="stage-circle"></div>
                            <div class="stage-line"></div>
                        </div>
                        <div class="stage-content">
                            <div class="stage-title">Finding relevant documents</div>
                            <div class="stage-detail"></div>
                        </div>
                    </div>
                    
                    <div class="thinking-stage" id="stage-analyzing">
                        <div class="stage-indicator">
                            <div class="stage-circle"></div>
                            <div class="stage-line"></div>
                        </div>
                        <div class="stage-content">
                            <div class="stage-title">Analyzing document contents</div>
                            <div class="stage-detail"></div>
                        </div>
                    </div>
                    
                    <div class="thinking-stage" id="stage-generating">
                        <div class="stage-indicator">
                            <div class="stage-circle"></div>
                            <div class="stage-line"></div>
                        </div>
                        <div class="stage-content">
                            <div class="stage-title">Generating response</div>
                            <div class="stage-detail"></div>
                        </div>
                    </div>
                    
                    <div class="thinking-stage" id="stage-finalizing">
                        <div class="stage-indicator">
                            <div class="stage-circle"></div>
                        </div>
                        <div class="stage-content">
                            <div class="stage-title">Finalizing results</div>
                            <div class="stage-detail"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="search-info">This may take up to 90 seconds</div>
            <div class="sparkle-container bottom">
                <div class="sparkle sparkle-7"></div>
                <div class="sparkle sparkle-8"></div>
                <div class="sparkle sparkle-9"></div>
                <div class="sparkle sparkle-10"></div>
                <div class="sparkle sparkle-11"></div>
                <div class="sparkle sparkle-12"></div>
            </div>
        </div>
    </div>
</body>
</html>
